<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="记录查看kaldi训练生成的中间文件内容所需要的命令">
<meta property="og:type" content="article">
<meta property="og:title" content="kaldi查看文件">
<meta property="og:url" content="http://yoursite.com/2018/09/08/kaldi查看文件/index.html">
<meta property="og:site_name" content="CoderZWei&#39;s blog">
<meta property="og:description" content="记录查看kaldi训练生成的中间文件内容所需要的命令">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-09-08T06:15:16.130Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="kaldi查看文件">
<meta name="twitter:description" content="记录查看kaldi训练生成的中间文件内容所需要的命令">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/09/08/kaldi查看文件/"/>





  <title>kaldi查看文件 | CoderZWei's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">CoderZWei's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/08/kaldi查看文件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CoderZWei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/panpan.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CoderZWei's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">kaldi查看文件</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-08T14:13:59+08:00">
                2018-09-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>记录查看kaldi训练生成的中间文件内容所需要的命令</p>
<a id="more"></a>
<ol>
<li>ark,scp文件</li>
</ol>
<p>~/kaldi/src/featbin/copy-feats ark:raw_mfcc_dev.10.ark ark,t:-|head<br>ark存的试二进制文件，scp可以直接用cat命令看。</p>
<p>   2.fst文件</p>
<p>~/kaldi/tools/openfst-1.6.2/bin/fstprint L.fst | head -n 10<br>~/kaldi/tools/openfst-1.6.2/bin/fstprint –isymbols=phones.txt –osymbols=words.txt L.fst | head -n 15<br>fstdraw [–isymbols=phones.txt –osymbols=words.txt] L.fst | dot –Tps  |  ps2pdf – L.pdf<br>~/kaldi/tools/openfst-1.6.2/bin/fstdraw –isymbols=phones.txt –osymbols=words.txt HCLG.fst</p>
<p>3.mfcc 生成的文件<br>~/kaldi/src/featbin/copy-feats ark:raw_mfcc_test_hires.1.ark ark,t:- | head<br>在文件前边加ark关键字，告诉copy-feats是什么格式的，还有后面加一个ark,t:- 表示输出格式为t文本，否则默认是二进制。<br>~/kaldi/src/featbin/copy-feats ark:raw_mfcc_dev.10.ark ark:- |~/kaldi/src/featbin/add-deltas ark:- ark,t:- | head<br>这样可以看到40维的数据</p>
<p>4.mdl文件<br>~/kaldi/src/gmmbin/gmm-copy –binary=false 0.mdl - </p>
<p>5.tree文件<br>~/kaldi/src/bin/copy-tree –binary=false tree -<br>~/kaldi/src/bin/draw-tree ../../data/lang/phones.txt tree | dot -Gsize=50,100 -Tps|ps2pdf - tree.pdf</p>
<p>6.ali.1.gz 对齐文件</p>
<p>1）~/kaldi/src/bin/copy-int-vector “ark:gunzip -c ali.1.gz|” ark,t:- |head -n 1</p>
<p>  代表的是每句话和transition-id的对应关系，每个transition-id对应一个特征向量</p>
<p>$ copy-int-vector “ark:gunzip -c ali.1.gz|” ark,t:- | head -n 1</p>
<p>如：</p>
<blockquote>
<p>speaker001_00003 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 16 15 15 15 18 890 889 889 889 889 889 889 892 894 893 893 893 86 88 87 90 89 89 89 89 89 89 89 89 89 89 89 89 89 89 194 193 196 195 195 198 197 386 385 385 385 385 385 385 385 385 388 387 387 390 902 901 901 904 903 906 905 905 905 905 905 905 905 905 905 905 905 914 913 913 916 918 917 917 917 917 917 917 752 751 751 751 751 751 754 753 753 753 753 753 753 753 753 756 755 755 926 925 928 927 927 927 927 927 927 927 930 929 929 929 929 929 929 929 929 4 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 16 18</p>
</blockquote>
<p>2）可以先解压 gunzip ali.1.gz<br>然后  ~/kaldi/src/bin/show-alignments ../../data/lang/phones.txt 40.mdl ark:ali.1 |head -n 2</p>
<p>3）若要查看其中的transition-id和transition-state的对应关系：</p>
<p>show-transitions data/lang/phones.txt exp/mono/0.mdl</p>
<p>如：</p>
<blockquote>
<p>Transition-state 1: phone = sil hmm-state = 0 pdf = 0</p>
<p>Transition-id = 1 p = 0.966816 [self-loop]</p>
<p>Transition-id = 2 p = 0.01 [0 -&gt; 1]</p>
<p>Transition-id = 3 p = 0.01 [0 -&gt; 2]</p>
<p>Transition-id = 4 p = 0.013189 [0 -&gt; 3]</p>
<p>Transition-state 2: phone = sil hmm-state = 1 pdf = 1</p>
<p>Transition-id = 5 p = 0.970016 [self-loop]</p>
<p>Transition-id = 6 p = 0.01 [1 -&gt; 2]</p>
<p>Transition-id = 7 p = 0.01 [1 -&gt; 3]</p>
<p>Transition-id = 8 p = 0.01 [1 -&gt; 4]</p>
<p>Transition-state 3: phone = sil hmm-state = 2 pdf = 2</p>
<p>Transition-id = 9 p = 0.01 [2 -&gt; 1]</p>
<p>Transition-id = 10 p = 0.968144 [self-loop]</p>
<p>Transition-id = 11 p = 0.01 [2 -&gt; 3]</p>
<p>Transition-id = 12 p = 0.0118632 [2 -&gt; 4]</p>
<p>Transition-state 4: phone = sil hmm-state = 3 pdf = 3</p>
<p>Transition-id = 13 p = 0.01 [3 -&gt; 1]</p>
<p>Transition-id = 14 p = 0.01 [3 -&gt; 2]</p>
<p>Transition-id = 15 p = 0.932347 [self-loop]</p>
<p>Transition-id = 16 p = 0.0476583 [3 -&gt; 4]</p>
</blockquote>
<p>其中一个transition-state对应唯一的pdf，其下又包括多个transition-id</p>
<p>若要增加可读性：</p>
<p>show-transitions data/lang/phones.txt exp/mono/final.mdl exp/mono/final.occs | less</p>
<p>(.occs文件是指occupation counts)</p>
<p>7.查看mfcc特征文件</p>
<p>copy-feats copy-matrix</p>
<p>8.查看vad特征文件</p>
<p>copy-vector</p>
<p>9.查看fsts.1.gz</p>
<p>fstcopy ‘ark:gunzip -c exp/mono0a/fsts.1.gz|’ ark,t:- | head -n 20</p>
<p>10.查看hmm结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">show-transitions phones.txt 1.mdl 1.occs</div></pre></td></tr></table></figure>
<p>11.查看mdl文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">copy-transition-model --binary=false 1.mdl 1.txt</div></pre></td></tr></table></figure>
<p>12.只查看ali文件的数字对齐部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">copy-int-vector ark:1.ali ark,t:-</div></pre></td></tr></table></figure>
<p>13.查看hmm的整体信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">hmm-info trans.mdl 或 am-info trans.mdl</div><div class="line">输出为：</div><div class="line">hmm-info final.mdl</div><div class="line">number of phones 48</div><div class="line">number of pdfs 144</div><div class="line">number of transition-ids 288</div><div class="line">number of transition-states 144</div></pre></td></tr></table></figure>
<p>14.查看tree信息</p>
<p>tree-info tree</p>
<p>15.查看网络结构和信息</p>
<p>nnet-am-copy –binary=false baseline/exp/nnet4d/final.mdl - </p>
<p> nnet-am-info </p>
<p>16.若要将对齐文件中的transition-id转化为对应的pdf-d:</p>
<p>ali-to-pdf final.mdl “ark:gunzip -c ali.1.gz|” ark,t:- | head -n 1 </p>
<blockquote>
<p>输出</p>
<p>speaker001_00003 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 3 3 3 4 440 440 440 440 440 440 440 441 442 442 442 442 38 39 39 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 92 92 93 93 93 94 94 188 188 188 188 188 188 188 188 188 189 189 189 190 446 446 446 447 447 448 448 448 448 448 448 448 448 448 448 448 448 452 452 452 453 454 454 454 454 454 454 454 371 371 371 371 371 371 372 372 372 372 372 372 372 372 372 373 373 373 458 458 459 459 459 459 459 459 459 459 460 460 460 460 460 460 460 460 460 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 4 </p>
</blockquote>
<p>对比之前的copy-int-vector查看的对其文件的前两帧，4和1两个transition-id都对应于一个pdf-id：0</p>
<p>17.ali-to-post: 根据得到的pdf-id，生成[pdf, post]对，即pdf与其对应的后验概率</p>
<blockquote>
<p>ali-to-pdf final.mdl “ark:gunzip -c ali.1.gz|” ark,t:- | head -n 1 | ali-to-post ark,t:- ark,t:-</p>
<p> speaker001_00003 [ 0 1 ][ 0 1 ][ 0 1 ][ 0 1 ][ 0 1 ][ 0 1 ][ 0 1 ][ 0 1 ][ 0 1 ][ 0 1 ][ 0 1 ][ 0 1 ][ 0 1 ][ 0 1 ][ 0 1 ] ……[ 3 1 ][ 3 1 ][ 3 1 ][ 3 1 ][ 4 1 ][ 440 1 ][ 440 1 ][ 440 1 ][ 440 1 ][ 440 1 ][ 440 1 ][ 440 1 ][ 441 1 ][ 442 1 ][ 442 1 ][ 442 1 ][ 442 1 ][ 38 1 ][ 39 1 ][ 39 1 ][ 40 1 ][ 40 1 ][ 40 1 ][ 40 1 ][ 40 1 ][ 40 1 ][ 40 1 ][ 40 1 ][ 40 1 ][ 40 1 ][ 40 1 ][ 40 1 ][ 40 1 ][ 40 1 ][ 40 1 ][ 92 1 ][ 92 1 ]…… [ 0 1 ][ 0 1 ][ 0 1 ][ 0 1 ][ 3 1 ][ 4 1 ]</p>
<p>可以得到pdf-id及相应的后验概率，这里均为1</p>
</blockquote>
<p>18.G.fst用于对语言模型建模，当使用统计语言模型时，用srilm训练出来的语言模型位arpa格式，可以用arpafst将arpa转换成fst</p>
<p>训练dnn:</p>
<p>1、steps/nnet2/train_pnorm_fast.sh </p>
<p>2、steps/nnet2/train_tanh.sh</p>
<p><a href="http://www.kaldi-asr.org/doc/append-vector-to-feats_8cc.html" target="_blank" rel="external">append-vector-to-feats</a> ：</p>
<p>在特征后加vector</p>
<p><a href="http://www.kaldi-asr.org/doc/compute-spectrogram-feats_8cc.html" target="_blank" rel="external">compute-spectrogram-feats</a> </p>
<p>计算**特征</p>
<p>pdf( probability density functions )：概率密度函数</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/09/08/kaldi音频特征提取/" rel="next" title="kaldi音频特征提取">
                <i class="fa fa-chevron-left"></i> kaldi音频特征提取
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/09/08/毕设总结/" rel="prev" title="毕设总结">
                毕设总结 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/panpan.jpg"
                alt="CoderZWei" />
            
              <p class="site-author-name" itemprop="name">CoderZWei</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CoderZWei</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  







  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  









<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>



  





  

  

  

  
  

  

  

  

</body>
</html>
